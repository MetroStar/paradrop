#version: '3.9'

services:
  opensearch:
    container_name: opensearch
    environment:
      discovery.type: single-node
      http.cors.enabled: "false"
      network.host: 0.0.0.0
      OPENSEARCH_JAVA_OPTS: "-Xms4g -Xmx12g"
      OPENSEARCH_INITIAL_ADMIN_PASSWORD: "dtYe2cKY2YtyBEJ49a"
    image: opensearchproject/opensearch:2.11.1
    networks:
      - paradrop
    ports:
      - 127.0.0.1:9200:9200
    restart: always
    volumes:
      - ./elk/internal_users.yml:/usr/share/opensearch/config/opensearch-security/internal_users.yml:rw

  opensearch_dashboards:
    container_name: opensearch_dashboards
    depends_on:
      opensearch:
        condition: service_started
    environment:
      SERVER_HOST: 0.0.0.0
    image: opensearchproject/opensearch-dashboards:2.11.1
    networks:
      - paradrop
    ports:
      - 127.0.0.1:5601:5601
    restart: always
    volumes:
    - ./elk/opensearch_dashboards.yml:/usr/share/opensearch-dashboards/config/opensearch_dashboards.yml:ro

  api:
    build:
      context: ./api
    container_name: paradrop_api
    depends_on:
      opensearch:
        condition: service_started
    networks:
      - paradrop
    ports:
      - 127.0.0.1:5000:5000
    restart: always

  ui:
    build:
      context: ./ui
      args:
        - URL
    container_name: paradrop_ui
    depends_on:
      api:
        condition: service_started
      opensearch:
        condition: service_started
    networks:
      - paradrop
    ports:
      - 8443:443
    restart: always

  docs:
    build:
      context: ./docs
    container_name: paradrop_docs
    depends_on:
      ui:
        condition: service_started
    networks:
      - paradrop
    ports:
      - 127.0.0.1:3008:3008
    restart: always

networks:
  paradrop:
    driver: bridge
